<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel="stylesheet" href="discussion.css">
    <title>Discussion Page</title>
</head>

<body onload="getChannels()">
    <nav class="navbar navbar-expand-lg">
        <div class="container-fluid">
            <span class="navbar-brand" href="#">Current Discussion Name</span>
            <div class="collapse navbar-collapse" id="navbarText">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="select-discussion.html">Home</a>
                    </li>
                </ul>
                <form action="/logout">
                    <button type="logout" class="btn btn-secondary">Logout</button>
                </form>
            </div>
        </div>
    </nav>
    <div class="container-fluid">
        <div class="row">
            <div class="channels col-2">
                <div class="header">
                    <span class="navbar-brand">Channels</span>
                </div>
                <div id="channel-select">
                </div>
            </div>
            <div class="discussion col-10">
                <input class="text-box" type="text" onkeypress="sendMessage();" placeholder="Type your message here...">
                <div class="text-box-background"></div>
                <div id="messages">
                    Lorem ipsum dolor sit amet consectetur adipisicing elit. Quia eligendi autem maxime. Maxime nisi ea accusantium quaerat iure exercitationem non aliquid, optio tempora mollitia neque, unde sed vitae magni sequi.
                   sicing elit. Quia eligendi autem maxime. Maxime nisi ea accusantium quaerat iure exercitationem non aliquid, optio tempora mollitia neque, unde sed vitae magni sequi.
                    Lorem ipsum dolor sit amet consectetur adipisicing elit. Quia eligendi autem maxime. Maxime nisi ea accusantium quaerat iure exercitationem non aliquid, optio tempora mollitia neque, unde sed vitae magni sequi.
                    Lorem ipsum dolor sit amet consectetur adipisicing elit. Quia eligendi autem maxime. Maxime nisi ea accusantium quaerat iure exercitationem non aliquid, optio tempora mollitia neque, unde sed vitae magni sequi.
                    Lorem ipsum dolor sit amet consectetur adipisicing elit. Quia eligendi autem maxime. Maxime nisi ea accusantium quaerat iure exercitationem non aliquid, optio tempora mollitia neque, unde sed vitae magni sequi.
                    Lorem ipsum dolor sit amet consectetur adipisicing elit. Quia eligendi autem maxime. Maxime nisi ea accusantium quaerat iure exercitationem non aliquid, optio tempora mollitia neque, unde sed vitae magni sequi.
                    Lorem ipsum dolor sit amet consectetur adipisicing elit. Quia eligendi autem maxime. Maxime nisi ea accusantium quaerat iure exercitationem non aliquid, optio tempora mollitia neque, unde sed vitae magni sequi.
                    aowidjawiodj
                </div>

            </div>
        </div>

    </div>
    <script>
        // test function to add messages to the discussion
        function sendMessage() {
            var key = window.event.keyCode;
            if (key === 13 && document.getElementsByClassName("text-box")[0].value != "") {
                console.log("Enter pressed");
                var message = document.getElementsByClassName("text-box")[0].value;
                var messages = document.getElementById("messages");
                var newMessage = document.createElement("div");
                newMessage.className = "message";
                var user = document.createElement("div");
                user.className = "user";
                user.innerHTML = "<strong>User 1</strong>";
                var text = document.createElement("div");
                text.className = "text";
                text.innerHTML = message;
                newMessage.appendChild(user);
                newMessage.appendChild(text);
                messages.appendChild(newMessage);
                document.getElementsByClassName("text-box")[0].value = "";
                
                messages.scrollTo(0, 1000);
            }
        }
        function getChannels() {
            console.log("getChannels called");
            var xmlhttp = new XMLHttpRequest();
            xmlhttp.onreadystatechange = function () {
                if (this.readyState == 4 && this.status == 200) {
                    document.getElementById("channel-select").innerHTML = this.responseText;
                }
            };
            // TODO: Set str to query discussion id
            // str = 
            xmlhttp.open("GET", "getChannels.php?q=" + str, true);
            xmlhttp.send();
        }





        
        //THIS IS THE AJAX TO CREATE A CHANNEL

        // SET THESE TO YOUR VALUES
        var name_input = 'TESTNAME';
        var board_id = '70';

        var xhr_create = new XMLHttpRequest();
        xhr_create.onreadystatechange = function() {
            if(xhr_create.readyState == 4 && xhr_create.status == 200) {
                if(this.responseText == "TRUE") {
                    // FETCH/RELOAD THE CHANNEL LIST HERE
                }
            }
        }
        xhr_create.open('POST', '/create-channel', false);
        xhr_create.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
        xhr_create.send('boardId='+board_id+'&name='+name_input);


        
        //THIS IS THE AJAX TO FETCH THE CHANNELS
        
        // SET THESE TO YOUR VALUES
        var board_id = '70';

        var xhr_fetch = new XMLHttpRequest();
        xhr_fetch.onreadystatechange = function() {
            if(xhr_fetch.readyState == 4 && xhr_fetch.status == 200) {
                // DO/CALL YOUR RENDER FROM IN HERE
                console.log(this.responseText);
            }
        }
        xhr_fetch.open('POST', '/fetch-channels-list', false);
        xhr_fetch.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
        xhr_fetch.send('boardId='+board_id);

        



        //THIS IS THE AJAX TO CREATE A MESSAGE

        // SET THESE TO YOUR VALUES
        var message = 'TESTMESSAGE';
        var channel_id = '5';

        var xhr_create = new XMLHttpRequest();
        xhr_create.onreadystatechange = function() {
            if(xhr_create.readyState == 4 && xhr_create.status == 200) {
                if(this.responseText == "TRUE") {
                    // FETCH/RELOAD THE MESSAGE LIST HERE
                }
            }
        }
        xhr_create.open('POST', '/create-message', false);
        xhr_create.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
        xhr_create.send('channelId='+channel_id+'&message='+message);


        
        //THIS IS THE AJAX TO FETCH THE MESSAGES
        
        // SET THESE TO YOUR VALUES
        var channel_id = '5';

        var xhr_fetch = new XMLHttpRequest();
        xhr_fetch.onreadystatechange = function() {
            if(xhr_fetch.readyState == 4 && xhr_fetch.status == 200) {
                // DO/CALL YOUR RENDER FROM IN HERE
                console.log(this.responseText);
            }
        }
        xhr_fetch.open('POST', '/fetch-messages-list', false);
        xhr_fetch.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
        xhr_fetch.send('channelId='+channel_id);
    </script>
</body>